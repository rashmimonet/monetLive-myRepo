(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"7c3Q":function(e,t,i){"use strict";i.d(t,"a",function(){return S});var n=i("mrSG"),a=i("fXoL"),s=i("pdnW"),o=i("WIjQ"),r=i("G6Tw"),c=i("XNiG"),l=i("kRoH"),d=i("v0EB"),u=i("yB+K"),v=i("0IaG"),h=i("tyNb"),b=i("iiAa"),g=i("tk/3"),m=i("LUsR"),f=i("XiUz"),w=i("bTqV"),p=i("NFeN"),D=i("jaxi"),k=i("ofXK");function y(e,t){if(1&e){const e=a.Yb();a.Xb(0,"mwl-calendar-month-view",19),a.fc("beforeViewRender",function(t){return a.Fc(e),a.jc().beforeMonthViewRender(t,"")})("dayClicked",function(t){return a.Fc(e),a.jc().dayClicked(t.day,t.day)})("eventClicked",function(t){return a.Fc(e),a.jc().handleEvent("Clicked",t.event)})("eventTimesChanged",function(t){return a.Fc(e),a.jc().eventTimesChanged(t)}),a.Wb()}if(2&e){const e=a.jc();a.qc("viewDate",e.viewDate)("events","outlook"===e.loggedInService?e.outlookEvents:e.events)("refresh",e.refresh)("activeDayIsOpen",e.activeDayIsOpen)}}function C(e,t){if(1&e){const e=a.Yb();a.Xb(0,"mwl-calendar-week-view",20),a.fc("eventClicked",function(t){return a.Fc(e),a.jc().handleEvent("Clicked",t.event)})("eventTimesChanged",function(t){return a.Fc(e),a.jc().eventTimesChanged(t)}),a.Wb()}if(2&e){const e=a.jc();a.qc("viewDate",e.viewDate)("events","outlook"===e.loggedInService?e.outlookEvents:e.events)("refresh",e.refresh)}}function E(e,t){if(1&e){const e=a.Yb();a.Xb(0,"mwl-calendar-day-view",20),a.fc("eventClicked",function(t){return a.Fc(e),a.jc().handleEvent("Clicked",t.event)})("eventTimesChanged",function(t){return a.Fc(e),a.jc().eventTimesChanged(t)}),a.Wb()}if(2&e){const e=a.jc();a.qc("viewDate",e.viewDate)("events","outlook"===e.loggedInService?e.outlookEvents:e.events)("refresh",e.refresh)}}let S=(()=>{class e{constructor(e,t,i,n,s,o,r,d){this.dialog=e,this.zone=t,this.api=i,this.route=n,this.tps=s,this.utility=o,this.http=r,this.bhvSub=d,this.eventList=new a.o,this.outlookEventList=new a.o,this.loggedInService="",this.selectedDays=[],this.view=l.d.Month,this.CalendarView=l.d,this.date=new Date,this.viewDate=new Date,this.actions=[{label:"edit",a11yLabel:"Edit",onClick:({event:e})=>{this.handleEvent("Edited",e)}},{label:"delete",a11yLabel:"Delete",onClick:({event:e})=>{this.events=this.events.filter(t=>t!==e),this.handleEvent("Deleted",e)}}],this.refresh=new c.a,this.events=[],this.outlookEvents=[],this.activeDayIsOpen=!0}ngOnInit(){this.route.queryParams.subscribe(e=>{this.params=e}),this.bhvSub.dynamicLink$.subscribe(e=>{this.dynamicLink=e}),this.userDetails=JSON.parse(localStorage.getItem("userDetails")),this.email=this.userDetails.email,this.api.getApiStatic("userplanDetails?email="+this.email).subscribe(e=>{this.meetingDuration=e.data[0].meetingDuration}),this.refreshEvents()}ngOnChanges(e){(null==e?void 0:e.deleteEvent)&&e.deleteEvent.currentValue&&this.deleteCalenderEvent(null==e?void 0:e.deleteEvent.currentValue)}refreshEvents(){setTimeout(()=>{this.tps.isLoggedIn().status?(this.loggedInService=this.tps.isLoggedIn().service,"google"===this.tps.isLoggedIn().service?this.listUpcomingGoogleEvents():this.listOutlookEvents()):this.loggedInService=this.tps.isLoggedIn().service},5e3)}listUpcomingGoogleEvents(){return Object(n.b)(this,void 0,void 0,function*(){if(localStorage.getItem("gapiAccessToken")){gapi.auth.setToken({access_token:localStorage.getItem("gapiAccessToken")});const e=yield this.tps.getGoogleCalenderEvents();this.updateEvents(e)}else{const e=yield this.tps.getGoogleCalenderEvents();this.updateEvents(e)}})}updateEvents(e){const t=[];return e.forEach(e=>{t.push({start:new Date(e.start.dateTime),end:new Date(e.end.dateTime),attendees:e.attendees,title:e.summary})}),this.events=t,this.zone.run(()=>{this.eventList.emit(t)}),e}dayClicked({date:e,events:t},i){const n=i.date.getDate().toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),a=i.date.getFullYear(),s=i.date.toLocaleString("default",{month:"short"}),c=new Date,l=c.getSeconds(),d=c.getMinutes(),u=c.getHours(),v=i.date.getDay();this.finalDateObj=new Date(`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][v].slice(0,3)} ${s} ${n} ${a} ${u}:${d}:${l} GMT+0530 (India Standard Time)`),this.checkDay=i,Object(o.a)(e,this.viewDate)&&(this.activeDayIsOpen=!(Object(r.a)(this.viewDate,e)&&!0===this.activeDayIsOpen||0===t.length),this.viewDate=e)}eventTimesChanged({event:e,newStart:t,newEnd:i}){this.events=this.events.map(n=>n===e?Object.assign(Object.assign({},e),{start:t,end:i}):n),this.handleEvent("Dropped or resized",e)}handleEvent(e,t){}setView(e){this.view=e}addEvent(){this.dialog.open(s.a,{data:{calDateSelect:this.finalDateObj},hasBackdrop:!0,width:"500px",height:"auto",maxHeight:"508px",backdropClass:"backdropBackground"}).afterClosed().subscribe(e=>{if(e&&e.form){e.form.end=e.end;const t=[];e.emails.map((e,i)=>{t[i]={email:e.toString().trim()}}),e.form.attendees=t,this.generateVideoUrl(e).then(e=>{}).catch(e=>{})}})}deleteCalenderEvent(e){return Object(n.b)(this,void 0,void 0,function*(){"google"===this.loggedInService?this.tps.deleteGoogleCalenderEvent(e,t=>{t&&this.deleteEventFromDatabase(e,this.loggedInService)}):"outlook"===this.loggedInService&&(this.tps.outlookDeleteEvent(e).subscribe(e=>{},e=>{console.error("Outlook Event Could not be deleted")}),this.deleteEventFromDatabase(e,this.loggedInService))})}deleteEventFromDatabase(e,t){this.api.deleteApi("room",e).subscribe(e=>{"google"===t?this.listUpcomingGoogleEvents():"outlook"===t&&this.listOutlookEvents()},e=>{console.error("Delete Api Error")})}inviteRoom(e,t){e.attendee=e.attendees,e.creator=JSON.parse(localStorage.getItem("userDetails")||"").name,e.creator_ID=JSON.parse(localStorage.getItem("userDetails")||"").email,e.groupUid=JSON.parse(localStorage.getItem("userDetails")||"").plan.groupUid,e.sourceId=t,e.source=this.loggedInService,e.observerEmail?(e.instance="",e.ip="",e.observerLink=`${location.origin}/monitor?roomid=${e.roomid}&id=${new Date}&grp=${e.instance}&instance=${e.ip}&summary=${e.summary}&duration=${JSON.parse(localStorage.getItem("userPlanDetails")||"{}").meetingDuration}`):console.error("Dynamic Link and Instance could not be found"),e.scheduled=!0,this.api.postApi1("inviteRoom",e).subscribe(e=>{e.error&&(console.error("Invite Room API error :",e.message),this.utility.notify(e.message,""))},e=>{console.error("Invite Room API Error :",e)})}generateVideoUrl(e){return Object(n.b)(this,void 0,void 0,function*(){const{name:t,email:i,settings:a}=JSON.parse(localStorage.getItem("userDetails")||"");this.http.post(`https://www.monetlive.com/${this.dynamicLink}/many/api/createCall`,{source:this.loggedInService,creator:t,creator_ID:i,settings:a}).subscribe(t=>Object(n.b)(this,void 0,void 0,function*(){if(t&&!t.error)if("Monet Education"===e.form.link&&(e.form.description="<b>Please join the link below</b><br/>https://www.monetlive.com/student/login?roomid="+t.response.roomid+"&room="+t.response.room+"&matrixScore="+JSON.parse(localStorage.getItem("userPlanDetails")||"{}").realTimeScores+"<br/>"+e.form.description,delete e.form.conferenceData.createRequest),this.tps.isLoggedIn().status&&"google"===this.tps.isLoggedIn().service){const i=yield this.tps.createGoogleCalenderEvent(e.form);this.inviteRoom(Object.assign(Object.assign({},t.response),e.form),i),yield this.listUpcomingGoogleEvents()}else if(this.tps.isLoggedIn().status&&"outlook"===this.tps.isLoggedIn().service){const i=e.emails.map(e=>({emailAddress:{address:e}}));this.tps.outlookCreateEvent(e.form.summary,e.form.body,e.form.start.dateTime,e.form.end.dateTime,i,e.form.description).subscribe(i=>{this.inviteRoom(Object.assign(Object.assign({},t.response),e.form),i.id),this.listOutlookEvents()})}else this.inviteRoom(Object.assign(Object.assign({},t.response),e.form),"");else console.error("Create Call Api Error :",null==t?void 0:t.message)}))})}closeOpenMonthViewDay(){this.activeDayIsOpen=!1}beforeMonthViewRender(e,t){e.body.forEach(e=>{this.checkDay&&JSON.stringify(this.checkDay.date)==JSON.stringify(e.date)&&(e.cssClass="bg-pink")})}listOutlookEvents(){this.tps.outlookGetEvents().subscribe(e=>{const t=[];e.value.forEach(e=>{t.push({start:new Date(e.start.dateTime),end:new Date(e.end.dateTime),attendees:e.attendees,title:e.subject})}),this.outlookEvents=t,this.outlookEventList.emit(t)})}}return e.\u0275fac=function(t){return new(t||e)(a.Rb(v.b),a.Rb(a.B),a.Rb(d.a),a.Rb(h.a),a.Rb(u.a),a.Rb(b.a),a.Rb(g.b),a.Rb(m.a))},e.\u0275cmp=a.Lb({type:e,selectors:[["app-calendar"]],inputs:{deleteEvent:"deleteEvent"},outputs:{eventList:"eventList",outlookEventList:"outlookEventList"},features:[a.Eb([d.a,u.a]),a.Db],decls:32,vars:13,consts:[["fxLayout","row","fxLayoutAlign","space-between center","fxLayoutGap","20px",2,"background","black","padding","1% 1%"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","end center",2,"background","black"],["f-white","","medium",""],["fxLayout","row",2,"background-color","rgba(255, 255 , 255, 0.2)"],["mat-button","","mwlCalendarToday","","f-white","",3,"viewDate","viewDateChange"],["mat-icon-button","","mwlCalendarPreviousView","",3,"view","viewDate","viewDateChange"],["f-white","","small",""],["mat-icon-button","","mwlCalendarNextView","",3,"view","viewDate","viewDateChange"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","end center"],["mat-icon-button","","id","refresh",3,"click"],["f-white",""],["name","fontStyle","aria-label","Font Style","value","Month"],["value","Month",3,"click"],["value","Week",3,"click"],["value","Day",3,"click"],["mat-raised-button","",3,"click"],[1,"calendar",3,"ngSwitch"],[3,"viewDate","events","refresh","activeDayIsOpen","beforeViewRender","dayClicked","eventClicked","eventTimesChanged",4,"ngSwitchCase"],[3,"viewDate","events","refresh","eventClicked","eventTimesChanged",4,"ngSwitchCase"],[3,"viewDate","events","refresh","activeDayIsOpen","beforeViewRender","dayClicked","eventClicked","eventTimesChanged"],[3,"viewDate","events","refresh","eventClicked","eventTimesChanged"]],template:function(e,t){1&e&&(a.Xb(0,"div",0),a.Xb(1,"div",1),a.Xb(2,"span",2),a.Pc(3),a.kc(4,"date"),a.Wb(),a.Xb(5,"div",3),a.Xb(6,"button",4),a.fc("viewDateChange",function(e){return t.viewDate=e}),a.Pc(7,"Today"),a.Wb(),a.Xb(8,"button",5),a.fc("viewDateChange",function(e){return t.viewDate=e})("viewDateChange",function(){return t.closeOpenMonthViewDay()}),a.Xb(9,"mat-icon",6),a.Pc(10,"arrow_back_ios"),a.Wb(),a.Wb(),a.Xb(11,"button",7),a.fc("viewDateChange",function(e){return t.viewDate=e})("viewDateChange",function(){return t.closeOpenMonthViewDay()}),a.Xb(12,"mat-icon",6),a.Pc(13,"arrow_forward_ios"),a.Wb(),a.Wb(),a.Wb(),a.Wb(),a.Xb(14,"div",8),a.Xb(15,"button",9),a.fc("click",function(){return t.refreshEvents()}),a.Xb(16,"mat-icon",10),a.Pc(17,"cached"),a.Wb(),a.Wb(),a.Xb(18,"mat-button-toggle-group",11),a.Xb(19,"mat-button-toggle",12),a.fc("click",function(){return t.setView(t.CalendarView.Month)}),a.Pc(20,"Month"),a.Wb(),a.Xb(21,"mat-button-toggle",13),a.fc("click",function(){return t.setView(t.CalendarView.Week)}),a.Pc(22,"Week"),a.Wb(),a.Xb(23,"mat-button-toggle",14),a.fc("click",function(){return t.setView(t.CalendarView.Day)}),a.Pc(24,"Day"),a.Wb(),a.Wb(),a.Xb(25,"button",15),a.fc("click",function(){return t.addEvent()}),a.Pc(26,"Add Event"),a.Wb(),a.Wb(),a.Wb(),a.Sb(27,"br"),a.Xb(28,"div",16),a.Nc(29,y,1,4,"mwl-calendar-month-view",17),a.Nc(30,C,1,3,"mwl-calendar-week-view",18),a.Nc(31,E,1,3,"mwl-calendar-day-view",18),a.Wb()),2&e&&(a.Fb(3),a.Qc(a.mc(4,10,t.viewDate,"medium")),a.Fb(3),a.qc("viewDate",t.viewDate),a.Fb(2),a.qc("view",t.view)("viewDate",t.viewDate),a.Fb(3),a.qc("view",t.view)("viewDate",t.viewDate),a.Fb(17),a.qc("ngSwitch",t.view),a.Fb(1),a.qc("ngSwitchCase",t.CalendarView.Month),a.Fb(1),a.qc("ngSwitchCase",t.CalendarView.Week),a.Fb(1),a.qc("ngSwitchCase",t.CalendarView.Day))},directives:[f.f,f.e,f.g,w.a,l.i,l.g,p.a,l.h,D.b,D.a,k.p,k.q,l.c,l.e,l.a],pipes:[k.e],styles:[".calendar[_ngcontent-%COMP%]{height:calc(100vh - 120px);overflow-y:auto}  .bg-pink{background-color:#d6eaf8!important}"]}),e})()},je0U:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("fXoL");let a=(()=>{class e{transform(e,...t){if(e){const t=Math.floor(e/1e3/60/60);e-=1e3*t*60*60;const i=Math.floor(e/1e3/60);return e-=1e3*i*60,t?Math.abs(t)+" h, "+i+" m":i+" Minutes"}return"0 Minutes"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=n.Qb({name:"duration",type:e,pure:!0}),e})()},tqkL:function(e,t,i){"use strict";i.d(t,"a",function(){return E});var n=i("ofXK"),a=i("FpXt"),s=i("0IaG"),o=i("o9rZ"),r=i("L/mj"),c=i("kRoH"),l=i("jaxi"),d=i("bTqV"),u=i("NFeN"),v=i("f0Cb"),h=i("iadO"),b=i("n1FK"),g=i("3Pt+"),m=i("qFsG"),f=i("kmnG"),w=i("Wp6s"),p=i("A5z7"),D=i("/1cH"),k=i("tk/3"),y=i("k78V"),C=i("fXoL");let E=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=C.Pb({type:e}),e.\u0275inj=C.Ob({imports:[[n.c,y.a,a.a,s.e,u.b,l.c,d.b,s.e,g.x,m.c,v.b,h.h,b.c,b.e,b.d,f.e,w.b,p.e,k.c,D.b,c.b.forRoot({provide:o.a,useFactory:r.a})]]}),e})()}}]);