(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"jJ+q":function(t,e,i){"use strict";i.r(e),i.d(e,"ManagerVideoModule",function(){return H});var n=i("ofXK"),s=i("0Lug"),a=i("v0EB"),o=i("fXoL"),r=i("tyNb"),d=i("kYN2"),l=i("LUsR"),c=i("iiAa"),u=i("XiUz"),h=i("c8Cp"),g=i("znSr"),m=i("q1A0"),p=i("0IaG"),b=i("zkoq"),f=i("cclQ"),v=i("xJfa"),x=i("WlQZ");let y=(()=>{class t{constructor(){this.series=[{name:"Engagement",color:"#ff8b51"},{name:"Mood",color:"#1393ff"}]}ngAfterViewInit(){this.createLineGraph()}ngOnChanges(t){var e;if(t.data&&this.chart){const i=this.chart.data.length>50?1:0;if(this.average){const i=Object.values(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.currentValue).reduce((t,e)=>(e.NumberOfFaces>0&&(t.engagement+=e.engagement,t.mood+=e.mood_score),t),{engagement:0,mood:0});Object.keys(i).forEach(e=>{var n;if(i[e])return i[e]=i[e]/Object.values(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.currentValue).length,i}),this.chart.addData(Object.assign(Object.assign({},i),{date:new Date}))}else{const e=t.data.currentValue[this.stdId];e&&this.chart.addData({date:(new Date).getTime(),engagement:e.engagement||0,mood:e.mood_score||0},i)}}}createLineGraph(){let t;const e=this;f.k(x.a),f.h.commercialLicense=!0,this.chart=f.e("line-"+this.stdId,v.i),this.chart.hiddenState.properties.opacity=0,this.chart.padding(0,0,0,0),this.chart.zoomOutButton.disabled=!0,this.chart.data=[];const i=this.chart.xAxes.push(new v.c),{renderer:n,periodChangeDateFormats:s}=i;i.dateFormats.setKey("second","ss"),s.setKey("second","[bold]h:mm a"),s.setKey("minute","[bold]h:mm a"),s.setKey("hour","[bold]h:mm a"),n.grid.template.location=0,n.minGridDistance=30,n.inside=!0,n.axisFills.template.disabled=!0,n.ticks.template.disabled=!0,n.labels.template.fill=f.d("#777"),n.labels.template.fontSize="12px";const a=this.chart.yAxes.push(new v.h);a.tooltip.disabled=!0,a.interpolationDuration=500,a.rangeChangeDuration=500,a.renderer.inside=!0;const{axisFills:o,ticks:r,labels:d}=a.renderer;o.template.disabled=!0,r.template.disabled=!0,d.template.fill=f.d("#777"),d.template.fontSize="12px",this.series.map(t=>{var e,i;const n=this.chart.series.push(new v.e);n.dataFields.dateX="date",n.dataFields.valueY=t.name.toLowerCase(),n.interpolationDuration=500,n.defaultState.transitionDuration=0,n.tooltipText="{"+t.name.toLowerCase()+"}",n.tooltip.getFillFromObject=!1,n.tooltip.background.fill=f.d(t.color),n.stroke=f.d(t.color),n.name=t.name,n.tooltipText="{name}: [bold]{valueY}[/]";const s=n.createChild(v.b);s.circle.radius=5,s.fillOpacity=1,s.fill=null===(i=null===(e=this.chart)||void 0===e?void 0:e.colors)||void 0===i?void 0:i.getIndex(0),s.isMeasured=!1,n.events.on("validated",()=>{var t,e;s.moveTo(null===(e=null===(t=null==n?void 0:n.dataItems)||void 0===t?void 0:t.last)||void 0===e?void 0:e.point),s.validatePosition()})}),this.chart.events.on("datavalidated",()=>{i.zoom({start:1/15,end:1.2},!1,!0)}),this.chart.events.on("beforedatavalidated",i=>{0===i.target.data.length?function(){if(t)t.show();else{t=e.chart.tooltipContainer.createChild(f.a),t.background.fill=f.d("#fff"),t.background.fillOpacity=.2,t.width=f.i(100),t.height=f.i(100);const i=t.createChild(f.b);i.text="No data...",i.align="center",i.valign="middle",i.fontSize=20,i.fill="white"}}():t&&t.hide()}),i.interpolationDuration=500,i.rangeChangeDuration=500,i.events.on("validated",()=>{f.f.each(i.renderer.labels.iterator(),t=>{t.fillOpacity=t.fillOpacity})}),i.renderer.labels.template.adapter.add("rotation",(t,e)=>{const i=e.dataItem;return i.date&&i.date.getTime()===f.j.round(new Date(i.date.getTime()),"minute",1).getTime()?(e.verticalCenter="middle",e.horizontalCenter="left",-90):(e.verticalCenter="bottom",e.horizontalCenter="middle",0)}),this.chart.legend=new v.d,this.chart.legend.contentAlign="left",this.chart.legend.data.map((t,e)=>{t.fill=f.d(this.series[e].color)}),this.chart.legend.fontSize="12px",this.chart.legend.maxWidth=100,this.chart.legend.labels.template.fill=f.d("#eee"),this.chart.legend.markers.template.width=12,this.chart.legend.markers.template.height=12,this.chart.legend.labels.template.textDecoration="none",this.chart.legend.valueLabels.template.textDecoration="none";const l=this.chart.legend.labels.template.states.getKey("active");l.properties.textDecoration="line-through",l.properties.fill=f.d("#777"),this.chart.legend.markers.template.children.getIndex(0).horizontalCenter="middle",this.chart.legend.useDefaultMarker=!0,this.chart.cursor=new v.j,this.chart.cursor.xAxis=a}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Lb({type:t,selectors:[["app-line-graph"]],inputs:{stdId:"stdId",data:"data",average:"average"},features:[o.Db],decls:2,vars:1,consts:[["fxFlex","",2,"height","100%","width","100%"],[3,"id"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Sb(1,"div",1),o.Wb()),2&t&&(o.Fb(1),o.qc("id","line-"+e.stdId))},styles:[""]}),t})();var w=i("sjQA"),O=i("bTqV");const _=["studentContainer"];function C(t,e){if(1&t&&(o.Xb(0,"div",7),o.Sb(1,"video",8),o.Sb(2,"app-line-graph",9),o.Wb()),2&t){const t=o.jc();o.Fb(2),o.qc("stdId","screen-share")("data",t.graphData)("average",!0)}}const L=function(){return["student-preview"]};function P(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"mat-grid-tile"),o.Xb(2,"div",10),o.Sb(3,"app-video-stream",11),o.Sb(4,"app-line-graph",12),o.Wb(),o.Wb(),o.Ub()),2&t){const t=e.$implicit,i=o.jc();o.Fb(2),o.qc("ngClass",o.tc(8,L)),o.Fb(1),o.qc("std",i.json.stringify(t))("mediaStreamObj",null==t?null:t.msobj)("selectUser",i.selectUser)("module","manager"),o.Fb(1),o.qc("stdId",t.std_id)("data",i.graphData)("average",!1)}}function k(t,e){1&t&&(o.Xb(0,"div",13),o.Xb(1,"span",14),o.Pc(2,"No participants"),o.Wb(),o.Wb())}let M=(()=>{class t{constructor(t,e,i,n,s,a,r){this.as=t,this.route=e,this.router=i,this.dialog=n,this.ss=s,this.bhvSub=a,this.utility=r,this.shouldLoad=!1,this.index=0,this.json=JSON,this.size={col:5,row:3},this.graphData={},this.studentEmit=new o.o}intracted(){this.shouldLoad=!0}ngOnChanges(t){var e,i,n;if((null===(e=null==t?void 0:t.selectUser)||void 0===e?void 0:e.currentValue)!==(null===(i=null==t?void 0:t.selectUser)||void 0===i?void 0:i.previousValue)&&!(null===(n=null==t?void 0:t.selectUser)||void 0===n?void 0:n.firstChange)){const e=t.selectUser.currentValue;this.router.navigate(["report/student-detail"],{queryParams:{roomid:e.roomid,student_id:e.std_id,module:"manager"}})}(null==t?void 0:t.Link)&&(this.dynamicLink=t.Link.currentValue)}getSubscribedUsers(t,e,i,n,s,a){const o=this.studentsList.find(t=>t.std_id===i.uuid);o?o.msobj=e:this.studentsList.push({audio:a.janus.audio,engAvg:NaN,msobj:e,screen:a.janus.screen,video:a.janus.video,webcam:a.janus.webcam,name:a.name,proctor:a.proctor,roomid:a.janus.room,serverIP:null,time:null,std_id:i.uuid}),this.studentsList.forEach((t,e)=>{t.std_id.includes("___")&&(this.studentsList=this.studentsList.filter(t=>{var e;return-1===(null===(e=null==t?void 0:t.std_id)||void 0===e?void 0:e.indexOf("___"))}),[this.screenshare,this.screen]=[!0,1],setTimeout(()=>{document.getElementById("screenShareStreem").srcObject=t.msobj},1e3))}),console.error("Students List(Updated) :",this.studentsList)}ngAfterViewInit(){this.route.queryParams.subscribe(t=>{this.param=t,0==this.index++&&this.getUsers(this.param.roomid)}),this.subSession=new StateSubscription(`wss://www.monetlive.com/${this.dynamicLink}/rtc/`,this.param.id,parseInt(this.room,10),this.ss.socket),this.subSession.start(),this.subSession.on("remote",({type:t,stream:e,slot:i,mid:n,sub:s,user:a})=>{setTimeout(()=>{this.getSubscribedUsers(t,e,s,i,n,a)},3e3)}),this.ss.socket.emit("add-manager",{roomid:this.param.roomid}),this.subSession.start(),this.ss.socket.on("face-data",t=>{this.graphData=t,t&&(this.studentsList=this.studentsList.map(e=>{var i,n;return e.engagement=Math.floor((null===(i=t[e.std_id])||void 0===i?void 0:i.engagement)||0),e.mood=Math.floor((null===(n=t[e.std_id])||void 0===n?void 0:n.mood_score)||0),e.category_engagement=e.engagement>80?"High":e.engagement>40?"Medium":"Low",e.category_mood=e.mood>80?"High":e.mood>40?"Medium":"Low",e}),this.studentEmit.emit(this.studentsList))}),this.ss.socket.on("leave",t=>{var e;Object.keys(null==t?void 0:t.userObj).length&&(this.studentsList=this.studentsList.filter(e=>{var i;return(null==e?void 0:e.std_id)!==(null===(i=null==t?void 0:t.userObj)||void 0===i?void 0:i.uuid)}),!1===t.userObj.janus.screen&&t.userObj.uuid.includes("___")&&([this.screen,this.screenshare,this.screenShareId]=[void 0,void 0,void 0]),this.studentEmit.emit(this.studentsList),this.utility.notify(t.userObj.name+((null===(e=null==t?void 0:t.userObj)||void 0===e?void 0:e.uuid.includes("___"))?" stopped sharing screen":" left the call"),""))})}trackByUsers(t,e){return e.std_id}ngOnInit(){document.body.click()}getUsers(t){this.as.getApi("user_list?id="+t).subscribe(t=>{if(t){if(t.response=t.response.filter(t=>{if(t.screen&&t.active&&(this.screenshare=!0),t.std_id!==this.param.id&&!t.screen&&t.active)return t}),t.response.length>1){const e=t.response.findIndex(t=>"proctor"===t.proctor);t.response.unshift(t.response.splice(e,1)[0])}if(this.selectUser){const e=this.selectUser.std_id;if(t.response.length>1){const i=t.response.findIndex(t=>t.std_id===e);t.response.unshift(t.response.splice(i,1)[0])}}this.studentsList=t.response,this.studentEmit.emit(this.studentsList)}})}ngOnDestroy(){}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(a.a),o.Rb(r.a),o.Rb(r.b),o.Rb(p.b),o.Rb(d.a),o.Rb(l.a),o.Rb(c.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["app-manager-video-panel"]],viewQuery:function(t,e){if(1&t&&o.Uc(_,1),2&t){let t;o.Cc(t=o.gc())&&(e.studentContainer=t.first)}},inputs:{module:"module",room:"room",actions:"actions",selectUser:"selectUser",Link:"Link"},outputs:{studentEmit:"studentEmit"},features:[o.Eb([a.a]),o.Db],decls:7,vars:6,consts:[["fxLayout","row","fxLayoutGap","10px"],["fxFlex","","class","screenshare-box","fxLayout","column","fxLayoutGap","20px",4,"ngIf"],["fxLayout","row wrap","fxLayoutGap","20px",1,"student-list",3,"fxFlex"],["studentContainer",""],["rowHeight","4:5","full-width","","gutterSize","5px",3,"cols"],[4,"ngFor","ngForOf","ngForTrackBy"],["fxFill","","fxLayout","row","fxLayoutAlign","center center",4,"ngIf"],["fxFlex","","fxLayout","column","fxLayoutGap","20px",1,"screenshare-box"],["id","screenShareStreem","height","100%","width","auto","autoplay","","muted","",1,"videocol"],[2,"max-height","200px","height","100%",3,"stdId","data","average"],["fxFill","","fxLayout","column","fxLayoutGap","10",3,"ngClass"],[2,"height","100%","border-bottom","1px solid #222",3,"std","mediaStreamObj","selectUser","module"],[3,"stdId","data","average"],["fxFill","","fxLayout","row","fxLayoutAlign","center center"],[2,"color","#ffffff","font-size","18px"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Nc(1,C,3,3,"div",1),o.Xb(2,"div",2,3),o.Xb(4,"mat-grid-list",4),o.Nc(5,P,5,9,"ng-container",5),o.Nc(6,k,3,0,"div",6),o.Wb(),o.Wb(),o.Wb()),2&t&&(o.Fb(1),o.qc("ngIf",e.screenshare),o.Fb(1),o.qc("fxFlex",e.screenshare?"350px":""),o.Fb(2),o.qc("cols",e.screenshare?1:4),o.Fb(1),o.qc("ngForOf",e.studentsList)("ngForTrackBy",e.trackByUsers),o.Fb(1),o.qc("ngIf",!(null!=e.studentsList&&e.studentsList.length)))},directives:[u.f,u.g,n.n,u.b,b.a,n.m,y,b.c,u.h,n.l,g.a,w.a,u.e],styles:[".student-list[_ngcontent-%COMP%]{height:calc(100vh - 80px);overflow-y:auto;padding:10px}.student-list[_ngcontent-%COMP%]   .student-preview[_ngcontent-%COMP%]{background:hsla(0,0%,100%,.1);box-sizing:border-box}.bubble[_ngcontent-%COMP%]{color:#fff;border-radius:50%;height:30px;width:30px}.avatar[_ngcontent-%COMP%], .bubble[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.avatar[_ngcontent-%COMP%]{border:1px solid #eee;height:50px;width:50px;border-radius:50%;text-align:center}.screenshare-box[_ngcontent-%COMP%]{background-color:#000;height:calc(100vh - 300px);margin:20px}.panel[_ngcontent-%COMP%]{margin:16px;height:auto}.panel[_ngcontent-%COMP%], .panel[_ngcontent-%COMP%]   .panel-head[_ngcontent-%COMP%]{border-radius:10px 10px 0 0}.panel[_ngcontent-%COMP%]   .panel-head[_ngcontent-%COMP%]{background-color:hsla(0,0%,100%,.1);padding:10px}.panel[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{height:100%!important;width:100%!important}.redDot[_ngcontent-%COMP%]{color:red}.greenDot[_ngcontent-%COMP%]{color:green}mat-grid-list[_ngcontent-%COMP%]{width:100%}.screen-div[_ngcontent-%COMP%]{max-width:70%;height:calc(100vh - 134px);position:relative;margin-right:10px}.screen-div[_ngcontent-%COMP%]   .title-name[_ngcontent-%COMP%]{padding:8px;border-top-right-radius:5px;border-top-left-radius:5px;font-size:16px;text-align:center;position:absolute;bottom:0;background:rgba(0,0,0,.43137254901960786);color:#fff}.single-grid[_ngcontent-%COMP%]{display:block;width:70%;margin:auto}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto auto;grid-gap:10px;padding:10px}.grid-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center;padding:5px;font-size:30px;grid-row-start:1;grid-row-end:1;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.item1[_ngcontent-%COMP%]{grid-row-start:1!important;grid-row-end:3!important;grid-column-start:1;grid-column-end:3}.full-screen-div[_ngcontent-%COMP%]{width:70%;margin:0 auto}.single-view[_ngcontent-%COMP%]   .videodiv[_ngcontent-%COMP%]{height:90%;width:60%}mat-card[_ngcontent-%COMP%]{background-color:#fff!important}.line-chart[_ngcontent-%COMP%]{height:120px!important;position:absolute;bottom:0;width:100%}"]}),t})();function j(t,e){if(1&t){const t=o.Yb();o.Xb(0,"app-manager-video-panel",7),o.fc("studentEmit",function(e){return o.Fc(t),o.jc().getStudents(e)}),o.Wb()}if(2&t){const t=o.jc();o.qc("room",t.room.room)("Link",t.dynamicLink)("module","manager")}}const F=function(){return["side-nav"]};let S=(()=>{class t{constructor(t,e,i,n,s,a,o,r,d){this.sl=t,this.router=e,this.route=i,this.datePipe=n,this.ss=s,this.api=a,this.zone=o,this.bhvSub=r,this.utility=d,this.loaded=!1,this.selectUser=!1,this.duration={time:"00:00:00",duration:0},this.date=new Date,this.students=[],this.messagePanel=!1}ngOnInit(){this.sl.load("janus").then(t=>{this.sl.load("user").then(e=>{t[0].loaded&&e[0].loaded&&this.route.queryParams.subscribe(t=>{t&&(this.param=t,this.dynamicLink=t.grp,this.ss.managerSocket(t.grp),this.bhvSub.obDynamicLink(t.grp),this.api.getApi("verifyObserver?roomid="+t.roomid).subscribe(e=>{e.error?(console.error("Error encountered in Verify observer API"),this.utility.notify(""+e.message,""),this.router.navigate(["/auth"])):this.getRoom(t.roomid)},t=>{console.error("Verify Observer API error")}))})})});const t=[{value:30,cat:"low"},{value:50,cat:"average"},{value:70,cat:"high"}];this.students.map(e=>(t.map(t=>{e.value>=t.value&&(e.cat=t.cat)}),e))}getRoom(t){this.api.getApi("getInviteRoom?roomid="+t).subscribe(t=>{t&&(this.room=t.response,this.loaded=!0)})}getStudents(t){this.students=t,0===this.duration.duration&&setInterval(()=>{this.duration.duration++,this.duration.time=this.datePipe.transform(1e3*this.duration.duration,"H:mm:ss","UTC")||""},1e3)}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(s.a),o.Rb(r.b),o.Rb(r.a),o.Rb(n.e),o.Rb(d.a),o.Rb(a.a),o.Rb(o.B),o.Rb(l.a),o.Rb(c.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["app-manager-video"]],features:[o.Eb([s.a,n.e,a.a])],decls:7,vars:8,consts:[["fxLayout","row","full-height",""],["fxLayout","column","fxLayoutAlign","start center","border","",2,"width","18vw","height","calc(100vh)"],["full-width","",3,"ngClass","moduleName","students"],["fxFlex","","fxLayout","row","full-height","","relative",""],["fxFlex",""],[3,"duration","room","role"],[3,"room","Link","module","studentEmit",4,"ngIf"],[3,"room","Link","module","studentEmit"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Xb(1,"div",1),o.Sb(2,"app-call-sidenav",2),o.Wb(),o.Xb(3,"div",3),o.Xb(4,"div",4),o.Sb(5,"app-top-bar",5),o.Nc(6,j,1,3,"app-manager-video-panel",6),o.Wb(),o.Wb(),o.Wb()),2&t&&(o.Fb(2),o.qc("ngClass",o.tc(7,F))("moduleName","manager")("students",e.students),o.Fb(3),o.qc("duration",e.duration)("room",e.room)("role","observer"),o.Fb(1),o.qc("ngIf",e.loaded))},directives:[u.f,u.e,h.a,n.l,g.a,u.b,m.a,n.n,M],styles:[".side-nav[_ngcontent-%COMP%]{overflow-y:auto}.message-btn[_ngcontent-%COMP%]{position:absolute;right:20px;bottom:20px}.message-panel[_ngcontent-%COMP%]{position:fixed;right:20px;bottom:80px;height:500px;width:300px;background:#fff;z-index:20}"]}),t})();var I=i("FpXt"),D=i("kmnG"),U=i("qFsG"),q=i("f0Cb"),z=i("3Pt+"),R=i("sOF7"),X=i("Qu3c"),A=i("NFeN"),E=i("4GZO"),N=i("folJ"),W=i("tk/3"),V=i("dNgK"),G=i("2ChS");let T=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({imports:[[n.c]]}),t})();var B=i("pMjG");let K=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({imports:[[I.a,A.b,O.b,X.b,W.c,V.c,G.a,b.b,p.e,T,B.a]]}),t})();var J=i("rjSt");const Q=[{path:"",component:S}];let H=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({imports:[[r.d.forChild(Q),n.c,I.a,D.e,U.c,O.b,q.b,z.x,R.a,X.b,A.b,E.a,K,N.a,J.a]]}),t})()}}]);